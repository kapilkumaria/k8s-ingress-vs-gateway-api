<configuration>
  <property name="APP_NAME" value="${spring.application.name:-city-images}"/>
  <property name="ENV" value="${ENV:-dev}"/>

  <appender name="JSON_CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LogstashEncoder">
      <!-- Grab MDC so trace_id/span_id from the OTel agent appear in logs -->
      <includeMdc>true</includeMdc>
      <!-- Your own static fields -->
      <customFields>{"service":"${APP_NAME}","env":"${ENV}"}</customFields>
      <!-- Optional: keep stack traces compact -->
      <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
        <maxDepthPerThrowable>50</maxDepthPerThrowable>
        <maxLength>20480</maxLength>
      </throwableConverter>
    </encoder>
  </appender>

  <!-- Tone down noisy libs if you like -->
  <logger name="org.springframework" level="INFO"/>
  <logger name="org.apache.coyote" level="WARN"/>
  <logger name="org.hibernate" level="WARN"/>

  <root level="INFO">
    <appender-ref ref="JSON_CONSOLE"/>
  </root>
</configuration>
